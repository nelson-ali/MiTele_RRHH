function getParametroVacio(){return{idOrganigrama:0,idArea:0,idUbicacion:0,idMaquina:0,idRelaboral:0,fechaIni:"",fechaFin:""}}function definirGrillaParaListaRelaborales(e){var a={datatype:"json",datafields:[{name:"nro_row",type:"integer"},{name:"fecha_nac",type:"string"},{name:"edad",type:"integer"},{name:"lugar_nac",type:"integer"},{name:"genero",type:"integer"},{name:"e_civil",type:"integer"},{name:"id_relaboral",type:"integer"},{name:"id_persona",type:"integer"},{name:"tiene_contrato_vigente",type:"integer"},{name:"id_fin_partida",type:"integer"},{name:"finpartida",type:"string"},{name:"ubicacion",type:"string"},{name:"id_condicion",type:"integer"},{name:"condicion",type:"string"},{name:"item",type:"integer"},{name:"tiene_item",type:"integer"},{name:"id_cargo",type:"integer"},{name:"cargo_codigo",type:"string"},{name:"cargo_resolucion_ministerial_id",type:"integer"},{name:"cargo_resolucion_ministerial",type:"string"},{name:"estado",type:"integer"},{name:"estado_descripcion",type:"string"},{name:"nombres",type:"string"},{name:"ci",type:"string"},{name:"expd",type:"string"},{name:"image_src",type:"string"},{name:"id_organigrama",type:"integer"},{name:"gerencia_administrativa",type:"string"},{name:"departamento_administrativo",type:"string"},{name:"id_area",type:"integer"},{name:"area",type:"string"},{name:"id_ubicacion",type:"integer"},{name:"ubicacion",type:"string"},{name:"num_contrato",type:"string"},{name:"fin_partida",type:"string"},{name:"partida",type:"integer"},{name:"id_procesocontratacion",type:"integer"},{name:"proceso_codigo",type:"string"},{name:"nivelsalarial",type:"string"},{name:"nivelsalarial_resolucion",type:"string"},{name:"cargo",type:"string"},{name:"sueldo",type:"numeric"},{name:"fecha_ini",type:"date"},{name:"fecha_incor",type:"date"},{name:"fecha_fin",type:"date"},{name:"fecha_baja",type:"date"},{name:"motivo_baja",type:"string"},{name:"relaboral_previo_id",type:"integer"},{name:"observacion",type:"string"},{name:"fecha_ing",type:"date"}],url:"/relaborales/listactivosengestion?gestion="+e,cache:!1},t=new $.jqx.dataAdapter(a);!function(){var e=prepareSimulator("grid");$("#divGridRelaborales").jqxGrid({theme:e,width:"100%",height:"590px",source:t,sortable:!0,altRows:!0,groupable:!0,columnsresize:!0,pageable:!0,pagerMode:"advanced",showfilterrow:!0,filterable:!0,showtoolbar:!0,autorowheight:!0,selectionmode:"checkbox",rendertoolbar:function(e){var a=$("<div></div>");e.append(a),a.append("<button title='Generar boletas.' id='regrowbutton' class='btn btn-sm btn-primary' type='button'><i class='fa fa-pencil-square-o fa-2x text-success' title='Generar boletas.'/></i></button>"),a.append("<button title='Ver calendario de turnos y permisos de manera global para la persona.' id='turnrowbutton' class='btn btn-sm btn-primary' type='button'><i class='fa fa-calendar fa-2x text-success' title='Vista Turnos Laborales por relaci&oacute;n laboral.'/></i></button>"),a.append("<button title='Refrescar Grilla' id='refreshbutton' class='btn btn-sm btn-primary' type='button'><i class='fa fa-repeat fa-2x text-default' title='Refrescar grilla.'/></i></button>"),a.append("<button title='Desagrupar.' id='cleargroupsrowbutton' class='btn btn-sm btn-primary' type='button'><i class='fa fa-chain-broken fa-2x text-default' title='Desagrupar.'/></i></button>"),a.append("<button title='Desfiltrar.' id='clearfiltersrowbutton' class='btn btn-sm btn-primary' type='button'><i class='gi gi-sorting fa-2x text-default' title='Desfiltrar.'/></i></button>"),$("#regrowbutton").jqxButton(),$("#turnrowbutton").jqxButton(),$("#refreshbutton").jqxButton(),$("#cleargroupsrowbutton").jqxButton(),$("#clearfiltersrowbutton").jqxButton(),$("#hdnIdRelaboralVista").val(0),$("#divCalculoFechas").hide(),$("#refreshbutton").on("click",function(){$("#divGridRelaborales").jqxGrid("updatebounddata")}),$("#cleargroupsrowbutton").off(),$("#cleargroupsrowbutton").on("click",function(){$("#divGridRelaborales").jqxGrid("cleargroups")}),$("#clearfiltersrowbutton").off(),$("#clearfiltersrowbutton").on("click",function(){$("#divGridRelaborales").jqxGrid("clearfilters")}),$("#regrowbutton").off(),$("#regrowbutton").on("click",function(){$("#divProgressBar").hide(),$("#divErrores").hide(),$("#divGrillaErrores").html("");var e=$("#divGridRelaborales").jqxGrid("selectedrowindexes");if(0<e.length)limpiarMensajesErrorPorValidacionFormularioRegistroMasivo(),cargarModalRegistroMasivoBoletas(),$("#popupFormularioRegistroMasivo").on("shown.bs.modal",function(){$("#lstExcepcion").focus()}),$("#popupFormularioRegistroMasivo").modal("show");else{$("#divMsjePorError").html(""),$("#divMsjePorError").append("Debe al menos seleccionar un registro para solicitar la generaci&oacute;n de las boletas de manera masiva."),$("#divMsjeNotificacionError").jqxNotification("open")}}),$("#turnrowbutton").off(),$("#turnrowbutton").on("click",function(){var e=$("#divGridRelaborales").jqxGrid("getselectedrowindex");if(0<=e){var a=$("#divGridRelaborales").jqxGrid("getrowdata",e);if(null!=a){var t=$("#divGridRelaborales").jqxGrid("selectedrowindexes");if(1==t.length){$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("enableAt",1),$("#divTabControlMarcaciones").jqxTabs({selectedItem:1}),$("#spanPrefijoCalendarioLaboral").html(""),$("#spanSufijoCalendarioLaboral").html(" Vs. Calendario de Excepciones (Individual)");var o=new Date,i=o.getDate(),r=o.getMonth(),n=o.getFullYear();0==a.estado&&(i=a.fecha_baja.getDate(),r=a.fecha_baja.getMonth(),n=a.fecha_baja.getFullYear());$("#calendar").html("");var c=iniciarCalendarioLaboralPorRelaboralTurnosYExcepcionesParaVerAsignaciones(a,a.id_relaboral,5,0,3,[],n,r,i);sumarTotalHorasPorSemana(c)}else{var l="Debe seleccionar un s&oacute;lo registro para la obtención de la vista de turnos laborales correspondientes.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(l),$("#divMsjeNotificacionError").jqxNotification("open")}}else{var l="Para acceder a la vista del registro, la persona debe haber tenido al menos un registro de relaci&oacute,n laboral que implica un estado ACTIVO o PASIVO.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(l),$("#divMsjeNotificacionError").jqxNotification("open")}switch($("#tabFichaPersonalTurnAndExcept").jqxTabs({theme:"oasis",width:"100%",height:"100%",position:"top"}),$("#tabFichaPersonalTurnAndExcept").jqxTabs({selectedItem:0}),$(".ddNombresTurnAndExcept").html(a.nombres+"&nbsp;"),$(".ddCIAndNumComplementoExpdTurnAndExcept").html(a.ci+a.num_complemento+" "+a.expd+"&nbsp;"),$("#ddCargoTurnAndExcept").html(a.cargo+"&nbsp;"),$("#ddProcesoTurnAndExcept").html(a.proceso_codigo+"&nbsp;"),$("#ddFinanciamientoTurnAndExcept").html(a.condicion+" (Partida "+a.partida+")"),$("#ddGerenciaTurnAndExcept").html(a.gerencia_administrativa+"&nbsp;"),""!=a.departamento_administrativo&&null!=a.departamento_administrativo?($("#ddDepartamentoTurnAndExcept").show(),$("#dtDepartamentoTurnAndExcept").show(),$("#ddDepartamentoTurnAndExcept").html(a.departamento_administrativo+"&nbsp;")):($("#dtDepartamentoTurnAndExcept").hide(),$("#ddDepartamentoTurnAndExcept").hide()),$("#ddUbicacionTurnAndExcept").html(a.ubicacion+"&nbsp;"),a.tiene_item){case 1:$("#dtItemTurnAndExcept").show(),$("#ddItemTurnAndExcept").show(),$("#ddItemTurnAndExcept").html(a.item+"&nbsp;");break;case 0:$("#dtItemTurnAndExcept").hide(),$("#ddItemTurnAndExcept").hide()}if($("#ddNivelSalarialTurnAndExcept").html(a.nivelsalarial+"&nbsp;"),$("#ddHaberTurnAndExcept").html(a.sueldo+"&nbsp;"),$("#ddFechaIngTurnAndExcept").html(fechaConvertirAFormato(a.fecha_ing,"-")+"&nbsp;"),null!=a.fecha_incor){var s=fechaConvertirAFormato(a.fecha_incor,"-");$("#dtFechaIncorTurnAndExcept").show(),$("#ddFechaIncorTurnAndExcept").show(),$("#ddFechaIncorTurnAndExcept").html(s+"&nbsp;")}else $("#dtFechaIncorTurnAndExcept").hide(),$("#ddFechaIncorTurnAndExcept").hide();switch($("#ddFechaIniTurnAndExcept").html(fechaConvertirAFormato(a.fecha_ini,"-")+"&nbsp;"),a.tiene_item){case 1:$("#dtFechaFinTurnAndExcept").hide(),$("#ddFechaFinTurnAndExcept").hide();break;case 0:$("#dtFechaFinTurnAndExcept").show(),$("#ddFechaFinTurnAndExcept").show(),$("#ddFechaFinTurnAndExcept").html(fechaConvertirAFormato(a.fecha_fin,"-")+"&nbsp;")}$("#ddEstadoDescripcionTurnAndExcept").html(a.estado_descripcion+"&nbsp;"),0==a.estado?($("#dtFechaBajaTurnAndExcept").show(),$("#ddFechaBajaTurnAndExcept").show(),$("#ddFechaBajaTurnAndExcept").html(fechaConvertirAFormato(a.fecha_baja,"-")+"&nbsp;"),$("#dtMotivoBajaTurnAndExcept").show(),$("#ddMotivoBajaTurnAndExcept").show(),$("#ddMotivoBajaTurnAndExcept").html(a.motivo_baja+"&nbsp;")):($("#dtFechaBajaTurnAndExcept").hide(),$("#ddFechaBajaTurnAndExcept").hide(),$("#dtMotivoBajaTurnAndExcept").hide(),$("#ddMotivoBajaTurnAndExcept").hide()),$("#ddNombresTurnAndExcept").html(a.nombres);var d=obtenerRutaFoto(a.ci,a.num_complemento);$("#imgFotoPerfilTurnAndExceptRelaboral").attr("src",d),$("#imgFotoPerfilContactoPerTurnAndExcept").attr("src",d),$("#imgFotoPerfilContactoInstTurnAndExcept").attr("src",d),$("#imgFotoPerfilTurnAndExcept").attr("src",d),cargarPersonasContactosHorariosYMarcaciones(2,a.id_persona)}else{var l="Debe seleccionar un registro necesariamente.";$("#divMsjePorError").html(""),$("#divMsjePorError").append(l),$("#divMsjeNotificacionError").jqxNotification("open")}})},columns:[{text:"Nro.",sortable:!1,filterable:!1,editable:!1,groupable:!1,draggable:!1,resizable:!1,columntype:"number",pinned:!0,width:50,cellsalign:"center",align:"center",cellsrenderer:rownumberrenderer},{text:"Nombres y Apellidos",columntype:"textbox",filtertype:"input",datafield:"nombres",pinned:!0,width:215,align:"center",hidden:!1},{text:"CI",columntype:"textbox",filtertype:"input",datafield:"ci",pinned:!0,width:90,cellsalign:"center",align:"center",hidden:!1},{text:"Exp",filtertype:"checkedlist",filteritems:["F","M"],datafield:"expd",pinned:!0,width:40,cellsalign:"center",align:"center",hidden:!1},{text:"G&eacute;nero",filtertype:"checkedlist",datafield:"genero",pinned:!0,width:40,cellsalign:"center",align:"center",hidden:!1},{text:"Ubicaci&oacute;n",filtertype:"checkedlist",datafield:"ubicacion",width:150,cellsalign:"center",align:"center",hidden:!1},{text:"Condici&oacute;n",filtertype:"checkedlist",datafield:"condicion",width:150,cellsalign:"center",align:"center",hidden:!1},{text:"Estado",filtertype:"checkedlist",datafield:"estado_descripcion",width:100,cellsalign:"center",align:"center",hidden:!1,cellclassname:cellclass},{text:"Gerencia",filtertype:"checkedlist",datafield:"gerencia_administrativa",width:220,align:"center",hidden:!1},{text:"Departamento",filtertype:"checkedlist",datafield:"departamento_administrativo",width:220,align:"center",hidden:!1},{text:"&Aacute;rea",filtertype:"checkedlist",datafield:"area",width:220,align:"center",hidden:!1},{text:"Proceso",filtertype:"checkedlist",datafield:"proceso_codigo",width:220,cellsalign:"center",align:"center",hidden:!1},{text:"Fuente",filtertype:"checkedlist",datafield:"fin_partida",width:220,cellsalign:"center",align:"center",hidden:!1},{text:"Nivel Salarial",filtertype:"checkedlist",datafield:"nivelsalarial",width:220,align:"center",hidden:!1},{text:"Cargo",columntype:"textbox",filtertype:"input",datafield:"cargo",width:215,align:"center",hidden:!1},{text:"Haber",filtertype:"checkedlist",datafield:"sueldo",width:100,cellsalign:"right",align:"center",hidden:!1},{text:"Fecha Ingreso",datafield:"fecha_ing",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Inicio",datafield:"fecha_ini",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Incor.",datafield:"fecha_incor",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Fin",datafield:"fecha_fin",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Baja",datafield:"fecha_baja",filtertype:"range",width:100,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Motivo Baja",datafield:"motivo_baja",width:100,hidden:!1},{text:"Observacion",datafield:"observacion",width:100,hidden:!1}]});$("#jqxlistbox").jqxListBox({source:[{label:"Ubicaci&oacute;n",value:"ubicacion",checked:!0},{label:"Condici&oacute;n",value:"condicion",checked:!0},{label:"Estado",value:"estado_descripcion",checked:!0},{label:"Nombres y Apellidos",value:"nombres",checked:!0},{label:"CI",value:"ci",checked:!0},{label:"Exp",value:"expd",checked:!0},{label:"G&eacute;nero",value:"genero",checked:!0},{label:"Gerencia",value:"gerencia_administrativa",checked:!0},{label:"Departamento",value:"departamento_administrativo",checked:!0},{label:"&Aacute;rea",value:"area",checked:!0},{label:"proceso",value:"proceso_codigo",checked:!0},{label:"Fuente",value:"fin_partida",checked:!0},{label:"Nivel Salarial",value:"nivelsalarial",checked:!0},{label:"Cargo",value:"cargo",checked:!0},{label:"Haber",value:"sueldo",checked:!0},{label:"Fecha Ingreso",value:"fecha_ing",checked:!0},{label:"Fecha Inicio",value:"fecha_ini",checked:!0},{label:"Fecha Incor.",value:"fecha_incor",checked:!0},{label:"Fecha Fin",value:"fecha_fin",checked:!0},{label:"Fecha Baja",value:"fecha_baja",checked:!0},{label:"Motivo Baja",value:"motivo_baja",checked:!0},{label:"Observacion",value:"observacion",checked:!0}],width:"100%",height:560,checkboxes:!0}),$("#jqxlistbox").on("checkChange",function(e){$("#divGridRelaborales").jqxGrid("beginupdate"),e.args.checked?$("#divGridRelaborales").jqxGrid("showcolumn",e.args.value):$("#divGridRelaborales").jqxGrid("hidecolumn",e.args.value),$("#divGridRelaborales").jqxGrid("endupdate")})}()}$().ready(function(){$("#divProgressBar").hide(),$("#divTabControlMarcaciones").jqxTabs("theme","oasis"),$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("disableAt",1),cargarGestionesRelaborales((new Date).getFullYear()),definirGrillaParaListaRelaborales($("#lstGestion").val()),$("#lstGestion").off(),$("#lstGestion").on("change",function(){definirGrillaParaListaRelaborales($("#lstGestion").val())}),$("#btnAplicarRegistroMasivo").off(),$("#btnAplicarRegistroMasivo").on("click",function(){$("#divErrores").hide();var e=validaFormularioRegistroMasivo();if(e){var a=$("#divGridRelaborales").jqxGrid("selectedrowindexes"),t=a.length,o="",i=0,r=0;if(0<t){var n="",c=0;$(".progress-bar",".bars-container").each(function(){var e=r+"%";$(this).css("width",e).html(e+" ["+i+":"+t+"]")}),$("#divProgressBar").show(),$("#divGrillaErrores").html("");for(var l=0;l<t;l++){i++;var s=$("#divGridRelaborales").jqxGrid("getrowdata",a[l]),d=s.id_relaboral,p=s.nombres,u=s.ci,h=s.expd,m=$("#lstExcepcion option:selected").data("id_genero"),f=s.genero,v=s.image_src,b=s.cargo,g=$("#lstExcepcion").val(),x=$("#txtFechaIni").val(),y=$("#txtHoraIni").val(),F=$("#txtFechaFin").val(),_=$("#txtHoraFin").val(),E=$("#lstExcepcion option:selected").data("horario"),S=verificaCruceDeHorariosYExcesoEnUso(0,d,g,x,y,F,_,E,$("#txtJustificacionRegistroMasivo").val()),T=verificaFrecuencia(0,d,g,x,y,F,_,E),j=verificaGenero(f,m);""==T&&""==S&&j?e=!0:(e=!1,""==n&&(n+="<table class='table table-striped table-vcenter'>",n+="<thead><tr>",n+="<th class='text-center'>Nro.</th>",n+="<th class='text-center'><i class='gi gi-user'></i></th>",n+="<th class='text-center'>Nombres</th>",n+="<th class='text-center'>CI</th>",n+="<th class='text-center'>Cargo</th>",n+="<th class='text-center'>Cruce</th>",n+="<th class='text-center'>Frecuencia</th>",n+="<th class='text-center'>G&eacute;nero</th>",n+="</tr>",n+="</thead>",n+="<tbody>"),n+="<tr>",n+="<td class='text-center'>"+ ++c+"</td>",n+="<td  class='text-center'><img class='img-circle' width='60px;' height='60px;' alt='"+p+"' src='"+v+"'></td>",n+="<td>"+p+"</td>",n+="<td>"+u+" "+h+"</td>",n+="<td>"+b+"</td>",n+=""==S?"<td class='text-center'><i class='fa fa-check fa-2x text-success'></i></td>":"<td>"+S+"</td>",n+=""==T?"<td class='text-center'><i class='fa fa-check fa-2x text-success'></i></td>":"<td>"+T+"</td>",n+=j?"<td class='text-center'><i class='fa fa-check fa-2x text-success'></i></td>":"<td class='text-center'><i class='fa fa-ban fa-2x text-danger'></i></td>",n+="</tr>"),e?(0,o+=d+","):0,r=(r=parseFloat(100*i/t)).toFixed(0),$(".progress-bar",".bars-container").each(function(){var e=r+"%";$(this).css("width",e).html(e+" ["+i+":"+t+"]")})}if(""!=n&&(n+="</tbody>",n+="</table>"),setTimeout(function(){$("#divProgressBar").hide()},3e3),""!=o&&(o=(o+=",").replace(",,","")),""!=n){$("#divErrores").show(),$("#divGrillaErrores").html(""),$("#divGrillaErrores").html(n);var M=i-c;0<M&&bootbox.confirm("Existen "+M+" registros admitidos de un total de "+i+", ¿desea solicitar su registro? Tenga en consideraci&oacute;n que no se registrar&aacute;n "+c+" registros.",function(e){e&&(guardarRegistrosMasivos(o),$("#popupFormularioRegistroMasivo").modal("hide"))})}else bootbox.confirm("Ha solicitado "+i+" registros, ¿confirma su solicitud?",function(e){e&&(guardarRegistrosMasivos(o),$("#popupFormularioRegistroMasivo").modal("hide"))})}}}),$("#chkAllCols").click(function(){1==this.checked?$("#jqxlistbox").jqxListBox("checkAll"):$("#jqxlistbox").jqxListBox("uncheckAll")}),$("#liList,#btnCancelarTurnAndExcept").click(function(){$("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs({selectedItem:0}),$("#divTabControlMarcaciones").jqxTabs("disableAt",1)}),$(".numeral").keyup(function(e){""!=$(this).val()&&$(this).val($(this).val().replace(/[^0-9]/g,""))}),$(".literal").keyup(function(e){""!=$(this).val()&&$(this).val($(this).val().replace(/[^A-Z,a-z,ñ,Ñ, ]/g,""))}),$("#divMsjeNotificacionError").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:7e3,template:"error"}),$("#divMsjeNotificacionWarning").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:7e3,template:"warning"}),$("#divMsjeNotificacionSuccess").jqxNotification({width:"100%",position:"bottom-right",opacity:.9,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:7e3,template:"success"}),$(document).keypress(OperaEvento),$(document).keyup(OperaEvento)});var rownumberrenderer=function(e,a,t,o,i,r){return"<div align='center'>"+(e+1)+"</div>"};function guardarRegistrosMasivos(e){var t=!1;null!=$("#lstExcepcion option:selected").data("lugar")&&$("#lstExcepcion option:selected").data("lugar");var a=$("#lstExcepcion").val(),o=($("#lstExcepcion option:selected").data("descuento"),$("#lstExcepcion option:selected").data("compensatoria"),$("#lstExcepcion option:selected").data("genero_id"),$("#lstExcepcion option:selected").data("cantidad"),$("#lstExcepcion option:selected").data("unidad"),$("#lstExcepcion option:selected").data("fraccionamiento"),$("#lstExcepcion option:selected").data("horario")),i=($("#lstExcepcion option:selected").data("refrigerio"),$("#txtFechaIni").val()),r=$("#txtHoraIni").val(),n=$("#txtFechaFin").val(),c=$("#txtHoraFin").val(),l=$("#txtJustificacionRegistroMasivo").val(),s=$("#txtDestino").val(),d=$("#txtObservacionRegistroMasivo").val(),p=$("#lstCompensacionTurno").val(),u=$("#lstCompensacionEntradaSalida").val();return""!=e&&$.ajax({url:"/controlexcepciones/savemasivebyrelaborales/",type:"POST",datatype:"json",async:!1,cache:!1,data:{ids:e,excepcion_id:a,fecha_ini:i,hora_ini:r,fecha_fin:n,hora_fin:c,justificacion:l,destino:s,turno:p,entrada_salida:u,horario:o,observacion:d},success:function(e){var a=jQuery.parseJSON(e);1==a.result?(t=!0,$("#divMsjePorSuccess").html(""),$("#divMsjePorSuccess").append(a.msj),$("#divMsjeNotificacionSuccess").jqxNotification("open")):0==a.result?($("#divMsjePorWarning").html(""),$("#divMsjePorWarning").append(a.msj),$("#divMsjeNotificacionWarning").jqxNotification("open")):($("#divMsjePorError").html(""),$("#divMsjePorError").append(a.msj),$("#divMsjeNotificacionError").jqxNotification("open"))},error:function(){$("#divMsjePorError").html(""),$("#divMsjePorError").append("Se ha producido un error Inesperado"),$("#divMsjeNotificacionError").jqxNotification("open")}}),t}function OperaEvento(e){"keyup"!=e.type&&"keydown"!=e.type||"27"!=e.which||($("#divTabControlMarcaciones").jqxTabs("enableAt",0),$("#divTabControlMarcaciones").jqxTabs("disableAt",1),$("#divTabControlMarcaciones").jqxTabs("disableAt",2),$("#divTabControlMarcaciones").jqxTabs("disableAt",3),$("#divTabControlMarcaciones").jqxTabs({selectedItem:0}),$("#divGridRelaborales").jqxGrid("updatebounddata"))}function procesaTextoAFecha(e,a){var t=e.split(a);return(e=new Date(t[1]+"/"+t[0]+"/"+t[2])).getTime()}function obtenerRutaFoto(e,a){var t="/images/perfil-profesional.jpg";return""!=e&&$.ajax({url:"/relaborales/obtenerrutafoto/",type:"POST",datatype:"json",async:!1,cache:!1,data:{ci:e,num_complemento:a},success:function(e){var a=jQuery.parseJSON(e);1==a.result&&(t=a.ruta)},error:function(){alert("Se ha producido un error Inesperado")}}),t}function fechaHoy(e,a){""==e&&(e="-");var t=new Date,o=t.getDate().toString(),i=(t.getMonth()+1).toString(),r=1===o.length?"0"+o:o,n=1===i.length?"0"+i:i;if("dd-mm-yyyy"==a)var c=r+e+n+e+t.getFullYear();else if("mm-dd-yyyy"==a)c=n+e+r+e+t.getFullYear();else c=t;return c}var cellclass=function(e,a,t){return"ACTIVO"==t?"verde":"EN PROCESO"==t?"amarillo":"PASIVO"==t?"rojo":""};function obtenerTodosHorariosRegistradosEnCalendarioRelaboralParaVerAsignaciones(e,a,t,F,o,i,r){var _=[],n=new Date,E=(n.getDate(),n.getMonth(),n.getFullYear(),!0);switch(t){case 1:case 2:E=!0}return $.ajax({url:"/calendariolaboral/listallregisteredbyrelaboralmixto",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e,id_perfillaboral:a,fecha_ini:o,fecha_fin:i},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){var t=0,o="00:00:00",i="24:00:00",r="#000000",n="DESCANSO",c=(a.perfil_laboral,a.perfil_laboral_grupo);null!=a.id_horariolaboral?(t=a.id_horariolaboral,n=a.horario_nombre,o=a.hora_entrada.split(":"),i=a.hora_salida.split(":"),r=a.color):(o=o.split(":"),i=i.split(":"));var l=a.calendario_fecha_ini.split("-"),s=l[0],d=l[1]-1,p=l[2],u=o[0],h=o[1],m=(o[2],a.calendario_fecha_fin.split("-")),f=m[0],v=m[1]-1,b=m[2],$=i[0],g=i[1],x=(i[2],"r_");0==t&&(x="d_");var y=r;F||(y="#000000",x="b_"),_.push({id:a.id_calendariolaboral,className:x+t,title:n,start:new Date(s,d,p,u,h),end:new Date(f,v,b,$,g),allDay:E,color:r,editable:F,borderColor:y,horas_laborales:a.horas_laborales,dias_laborales:a.dias_laborales,hora_entrada:a.hora_entrada,hora_salida:a.hora_salida})})}}),_}function ImageExist(e){var a=new Image;return a.src=e,0!=a.height}function fechaConvertirAFormato(e,a){""==a&&(a="-");var t=e,o=t.getDate(),i=t.getMonth(),r="",n="";return o<10&&(r="0"),(i+=1)<10&&(n="0"),r+o+a+n+i+a+t.getFullYear()}function iniciarCalendarioLaboralPorRelaboralTurnosYExcepcionesParaVerAsignaciones(u,h,e,m,f,a,t,o,i){f=parseInt(f);var v=[],b=7,r=($(".calendar-events"),"prev,next"),n="year",c=!0,l=!0,s=!0,d=!0;switch(e){case 1:case 2:case 3:switch(f){case 1:case 2:break;case 3:r="",n="year"}break;case 4:break;case 5:s=l=c=!1}switch(f){case 1:case 2:d=!1,!(b=5)}return $("#calendar").fullCalendar({header:{left:r,center:"title",right:n},year:t,month:o,date:i,firstDay:1,weekends:d,editable:c,droppable:l,selectable:s,weekNumbers:!0,weekNumberTitle:"#S",timeFormat:"H(:mm)",drop:function(e,a){var t=$(this).data("eventObject"),o=$.extend({},t);o.start=e,$("#calendar").fullCalendar("renderEvent",o,!0),sumarTotalHorasPorSemana(v)},eventDrop:function(e,a,t,o,i){sumarTotalHorasPorSemana(v)},events:a,eventClick:function(i,e,a){var r=i.className+"",t=r.split("_"),o=t[1];r=t[0];var n=0;null!=i.id&&(n=i.id);var c=fechaConvertirAFormato(i.start,"-"),l=c,s=i.start;null!=i.end&&""!=i.end&&(l=fechaConvertirAFormato(i.end,"-"),s=i.end);var d=i.start,p=s,u=s;($("#txtHorarioFechaIni").datepicker("setDate",i.start),$("#txtHorarioFechaFin").datepicker("setDate",s),$("#txtHorarioFechaIni").datepicker({format:"dd-mm-yyyy",default:i.start,weekStart:1,startDate:d,endDate:p,autoclose:!0}).on("changeDate",function(e){(d=new Date(e.date.valueOf())).setDate(d.getDate(new Date(e.date.valueOf()))),$("#txtHorarioFechaFin").datepicker("setStartDate",d)}),$("#txtHorarioFechaFin").datepicker({default:s,weekStart:1,startDate:d,endDate:u,autoclose:!0}).on("changeDate",function(e){(p=new Date(e.date.valueOf())).setDate(p.getDate(new Date(e.date.valueOf()))),$("#txtHorarioFechaIni").datepicker("setEndDate",p)}),0<o)?cargarModalHorario(o)?("b"==r?($("#btnDescartarHorario").hide(),$("#btnGuardarModificacionHorario").hide(),$("#txtHorarioFechaIni").prop("disabled","disabled"),$("#txtHorarioFechaFin").prop("disabled","disabled")):($("#btnDescartarHorario").show(),$("#txtHorarioFechaIni").prop("disabled",!1),$("#txtHorarioFechaFin").prop("disabled",!1)),$("#popupDescripcionHorario").modal("show"),$("#btnDescartarHorario").off(),$("#btnDescartarHorario").on("click",function(){switch(r){case"r":case"d":bajaTurnoEnCalendario(n)&&($("#calendar").fullCalendar("removeEvents",i._id),$("#popupDescripcionHorario").modal("hide"));break;case"n":$("#calendar").fullCalendar("removeEvents",i._id),$("#popupDescripcionHorario").modal("hide")}sumarTotalHorasPorSemana(v)}),$("#btnGuardarModificacionHorario").off(),$("#btnGuardarModificacionHorario").on("click",function(){switch(r){case"r":case"n":if(c!=$("#txtHorarioFechaIni").val()||l!=$("#txtHorarioFechaFin").val()){$("#calendar").fullCalendar("removeEvents",i._id),$("#popupDescripcionHorario").modal("hide");var e=$("#txtHorarioFechaIni").val(),a=$("#txtHorarioFechaFin").val(),t=e.split("-"),o=a.split("-");e=t[2]+"-"+t[1]+"-"+t[0],a=o[2]+"-"+o[1]+"-"+o[0],addEvent={id:i.id,title:i.title,className:i.className,start:e,end:a,color:i.color,editable:!0,hora_entrada:i.hora_entrada,hora_salida:i.hora_salida},$("#calendar").fullCalendar("renderEvent",addEvent,!0)}$("#popupDescripcionHorario").modal("hide")}sumarTotalHorasPorSemana(v)})):alert("Error al determinar los datos del horario."):alert("El registro corresponde a un periodo de excepción o salida")},eventResize:function(e,a,t){sumarTotalHorasPorSemana(v)},viewRender:function(e){switch(e.name){case"month":removerColumnaSumaTotales(),agregarColumnaSumaTotales(b);var r="",n="";v=[];var c=0,l=0,a=["mon","tue","wed","thu","fri","sat","sun"];$.each(a,function(e,a){l=0,$("td.fc-"+a).map(function(e,a){l++;var t=$(this).data("date"),o=$(this).data("date");if(null!=t){var i=t.split("-");switch(t=i[2]+"-"+i[1]+"-"+i[0],c=i[0],l){case 1:""==r&&(r=t),v.push({semana:1,fecha:t});break;case 2:v.push({semana:2,fecha:t});break;case 3:v.push({semana:3,fecha:t});break;case 4:v.push({semana:4,fecha:t});break;case 5:v.push({semana:5,fecha:t});break;case 6:n=t,v.push({semana:6,fecha:t})}o<$.fullCalendar.formatDate(new Date,"yyyy-MM-dd")&&$(this).css("background-color","#efefef")}})});var t="",o="",i=(t=fechaConvertirAFormato($("#calendar").fullCalendar("getDate"),"-")).split("-");o=obtenerUltimoDiaMes(t="01-"+i[1]+"-"+i[2]),$("#hdnFechaInicialCalendario").val(t),$("#hdnFechaFinalCalendario").val(o),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(m,h,r,n);var s=obtenerArrExcepcionesEnCalendarioPorRango(u,e.name,b,r,n);$("#calendar").fullCalendar("removeEvents");var d=obtenerTodosHorariosRegistradosEnCalendarioRelaboralParaVerAsignaciones(h,0,f,!1,r,n,0);$("#calendar").fullCalendar("addEventSource",d),$("#calendar").fullCalendar("addEventSource",s);var p=obtenerFeriadosRangoFechas(0,0,c,r,n);$.each(a,function(e,a){l=0,$("td.fc-"+a).map(function(e,a){l++;$(this).data("date");var t=$(this).data("date"),o="",i="",r=$(this);$.each(p,function(e,a){o=a.fecha_ini,i=a.fecha_fin;if(procesaTextoAFecha(t,"-")<=procesaTextoAFecha(i,"-")&&procesaTextoAFecha(t,"-")>=procesaTextoAFecha(o,"-")){$(".fc-day-content");r.append("<h6>(f) "+a.feriado+"</h6>"),r.css("background-color","orange")}})})}),sumarTotalHorasPorSemana(v);break;case"agendaWeek":o=obtenerFechaMasDias(t=fechaConvertirAFormato(t=$("#calendar").fullCalendar("getView").start,"-"),b-1),$("#hdnFechaInicialCalendario").val(t),$("#hdnFechaFinalCalendario").val(o),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(m,h,t,o);break;case"agendaDay":o=t=fechaConvertirAFormato($("#calendar").fullCalendar("getDate"),"-"),$("#hdnFechaInicialCalendario").val(t),$("#hdnFechaFinalCalendario").val(o),cargarGrillaAsignacionIndividualFechasUbicacionEstacion(m,h,t,o)}}}),v}function sumarTotalHorasPorSemana(a){var e=$("#calendar").fullCalendar("clientEvents"),n=0,c=0,l=0,s=0,d=0,p=0;$("#spSumaSemana1").html(0),$("#spSumaSemana2").html(0),$("#spSumaSemana3").html(0),$("#spSumaSemana4").html(0),$("#spSumaSemana5").html(0),$("#spSumaSemana6").html(0),$("#tdSumaSemana1").css("background-color","white"),$("#tdSumaSemana2").css("background-color","white"),$("#tdSumaSemana3").css("background-color","white"),$("#tdSumaSemana4").css("background-color","white"),$("#tdSumaSemana5").css("background-color","white"),$("#tdSumaSemana6").css("background-color","white"),$.each(e,function(e,t){var o=$.fullCalendar.formatDate(t.start,"dd-MM-yyyy"),i=$.fullCalendar.formatDate(t.end,"dd-MM-yyyy");""==i&&(i=o);var r="-";$.each(a,function(e,a){1==a.semana&&procesaTextoAFecha(o,r)<=procesaTextoAFecha(a.fecha,r)&&procesaTextoAFecha(a.fecha,r)<=procesaTextoAFecha(i,r)&&(n+=parseFloat(t.horas_laborales)),2==a.semana&&procesaTextoAFecha(o,r)<=procesaTextoAFecha(a.fecha,r)&&procesaTextoAFecha(a.fecha,r)<=procesaTextoAFecha(i,r)&&(c+=parseFloat(t.horas_laborales)),3==a.semana&&procesaTextoAFecha(o,r)<=procesaTextoAFecha(a.fecha,r)&&procesaTextoAFecha(a.fecha,r)<=procesaTextoAFecha(i,r)&&(l+=parseFloat(t.horas_laborales)),4==a.semana&&procesaTextoAFecha(o,r)<=procesaTextoAFecha(a.fecha,r)&&procesaTextoAFecha(a.fecha,r)<=procesaTextoAFecha(i,r)&&(s+=parseFloat(t.horas_laborales)),5==a.semana&&procesaTextoAFecha(o,r)<=procesaTextoAFecha(a.fecha,r)&&procesaTextoAFecha(a.fecha,r)<=procesaTextoAFecha(i,r)&&(d+=parseFloat(t.horas_laborales)),6==a.semana&&procesaTextoAFecha(o,r)<=procesaTextoAFecha(a.fecha,r)&&procesaTextoAFecha(a.fecha,r)<=procesaTextoAFecha(i,r)&&(p+=parseFloat(t.horas_laborales))})}),$("#spSumaSemana1").html(n.toFixed(2)),$("#spSumaSemana2").html(c.toFixed(2)),$("#spSumaSemana3").html(l.toFixed(2)),$("#spSumaSemana4").html(s.toFixed(2)),$("#spSumaSemana5").html(d.toFixed(2)),$("#spSumaSemana6").html(p.toFixed(2));var t=(c+l+s)/3;$("#spSumaPromedioTresSemanas").html(t.toFixed(2));48<n?$("#tdSumaSemana1").css("background-color","#FF4000"):$("#tdSumaSemana1").css("background-color","white"),48<c?$("#tdSumaSemana2").css("background-color","#FF4000"):$("#tdSumaSemana2").css("background-color","#efefef"),48<l?$("#tdSumaSemana3").css("background-color","#FF4000"):$("#tdSumaSemana3").css("background-color","#efefef"),48<s?$("#tdSumaSemana4").css("background-color","#FF4000"):$("#tdSumaSemana4").css("background-color","#efefef"),48<d?$("#tdSumaSemana5").css("background-color","#FF4000"):$("#tdSumaSemana5").css("background-color","white"),48<p?$("#tdSumaSemana6").css("background-color","#FF4000"):$("#tdSumaSemana6").css("background-color","white"),48<t?$("#tdSumaPromedioTresSemanas").css("background-color","red"):$("#tdSumaPromedioTresSemanas").css("background-color","white")}function agregarColumnaSumaTotales(e){$(".fc-border-separate tr:first").append("<th style='width: 87px;' id='thColumnaTotales' class='thColumnaTotales'> Hrs Semana </th>");var t=0;$(".fc-border-separate tr.fc-week").each(function(e,a){t++,$(this).append("<td id='tdSumaSemana"+t+"' class='tdSumaSemana fc-last'><div style='min-height: 67px;align-content: center;'><div id='divSumaSemana"+t+"' class='fc-day-suma-horas-semana'><span id='spSumaSemana"+t+"' class='spSumaSemana'>100</span></div></div></td>")});var a=e+1;$(".fc-border-separate tr:last").after("<tr id=''><td style='text-align: right;' colspan='"+a+"' class=''><b>Promedio semanal de horas (3 Semanas marcadas):</b></td><td id='tdSumaPromedioTresSemanas' class='tdSumaPromedioTresSemanas fc-first fc-day fc-last'><div style='min-height: 67px;align-content: center;'><div id='divSumaPromedioTresSemanas' class='fc-suma-promedio-horas-3-semanas'><span id='spSumaPromedioTresSemanas'>0</span></div></div></td></tr>")}function removerColumnaSumaTotales(){$("#thColumnaTotales").remove(),$("#tdSumaSemana1").remove(),$("#tdSumaSemana2").remove(),$("#tdSumaSemana3").remove(),$("#tdSumaSemana4").remove(),$("#tdSumaSemana5").remove(),$("#tdSumaSemana6").remove(),$("#trSumaPromedioTresSemanas").remove()}function numeroHoras(e){if(""==e)return 0;var a=e.split(":"),t=parseFloat(a[0]),o=parseFloat(a[1]),i=parseFloat(a[2]),r=0,n=0;return 0<i&&(r=i/60),0<(o+=r)&&(n=o/60),t+=n}function cargarGrillaAsignacionIndividualFechasUbicacionEstacion(e,a,t,o){var i,r={datatype:"json",datafields:[{name:"nro_row",type:"integer"},{name:"perfil_laboral",type:"string"},{name:"perfil_laboral_grupo",type:"string"},{name:"calendario_fecha_ini",type:"date"},{name:"calendario_fecha_fin",type:"date"},{name:"horario_nombre",type:"string"},{name:"relaboralperfilmaquina_ubicacion_entrada",type:"string"},{name:"relaboralperfilmaquina_estacion_entrada",type:"string"},{name:"relaboralperfilmaquina_ubicacion_salida",type:"string"},{name:"relaboralperfilmaquina_estacion_salida",type:"string"},{name:"relaboralperfilmaquina_tipo_marcacion_entrada_descripcion",type:"string"},{name:"relaboralperfilmaquina_tipo_marcacion_salida_descripcion",type:"string"},{name:"relaboralperfil_observacion",type:"string"}],url:"/calendariolaboral/getlistallregisteredbyrelaboral?id="+a+"&fecha_ini="+t+"&fecha_fin="+o,cache:!1},n=new $.jqx.dataAdapter(r);i=prepareSimulator("grid"),$("#divGridCalendario").jqxGrid({theme:i,width:"100%",height:"530px",source:n,sortable:!0,altRows:!0,columnsresize:!0,pageable:!0,pagerMode:"advanced",showfilterrow:!0,filterable:!0,autorowheight:!0,columns:[{text:"Nro.",filterable:!1,columntype:"number",width:40,cellsalign:"center",align:"center",cellsrenderer:rownumberrenderer},{text:"Perfil",filtertype:"checkedlist",datafield:"perfil_laboral",width:100,align:"center",hidden:!1},{text:"Grupo",filtertype:"checkedlist",datafield:"perfil_laboral_grupo",width:100,align:"center",hidden:!1},{text:"Fecha Inicio",datafield:"calendario_fecha_ini",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Fecha Fin",datafield:"calendario_fecha_fin",filtertype:"range",width:80,cellsalign:"center",cellsformat:"dd-MM-yyyy",align:"center",hidden:!1},{text:"Horario",filtertype:"checkedlist",datafield:"horario_nombre",width:100,align:"center",hidden:!1},{text:"Ubicaci&oacute;n Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_ubicacion_entrada",width:130,align:"center",hidden:!1},{text:"Estaci&oacute;n Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_estacion_entrada",width:100,align:"center",hidden:!1},{text:"Tipo Entrada",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_tipo_marcacion_entrada_descripcion",width:190,align:"center",hidden:!1},{text:"Ubicaci&oacute;n Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_ubicacion_salida",width:100,align:"center",hidden:!1},{text:"Estaci&oacute;n Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_estacion_salida",width:100,align:"center",hidden:!1},{text:"Tipo Salida",filtertype:"checkedlist",datafield:"relaboralperfilmaquina_tipo_marcacion_salida_descripcion",width:190,align:"center",hidden:!1},{text:"Observaci&oacute;n",filtertype:"checkedlist",datafield:"relaboralperfil_observacion",width:130,align:"center",hidden:!1}]})}function obtenerUltimoDiaMes(e){return e=$.ajax({url:"/perfileslaborales/getultimafechames/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:e},success:function(e){}}).responseText}function obtenerFechaMasDias(e,a){return e=$.ajax({url:"/perfileslaborales/getfechamasdias/",type:"POST",datatype:"json",async:!1,cache:!1,data:{fecha:e,dias:a},success:function(e){}}).responseText}function cerrarMensaje(e){alert("llego: "+e)}function cargarGestionesDisponiblesParaGeneracionMarcaciones(t){var o="";$("#lstGestionGeneracionMarcaciones").html(""),$("#lstGestionGeneracionMarcaciones").append("<option value=''>Seleccionar</option>"),$("#lstGestionGeneracionMarcaciones").prop("disabled",!1);$.ajax({url:"/perfileslaborales/getgestiones/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id_perfillaboral:0},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){o+="<option value='"+a+"' "+(t==a?"selected":"")+">"+a+"</option>"})}}),""!=o?$("#lstGestionGeneracionMarcaciones").append(o):$("#lstGestionGeneracionMarcaciones").prop("disabled",!0)}function cargarMesesDisponiblesParaGeneracionMarcaciones(e,t){$("#lstMesGeneracionMarcaciones").html(""),$("#lstMesGeneracionMarcaciones").append("<option value=''>Seleccionar</option>"),$("#lstMesGeneracionMarcaciones").prop("disabled",!1);var o="",i="";0<e?($.ajax({url:"/horariosymarcaciones/getmeses/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:e},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){i=t==a.mes?"selected":"",o+="<option value='"+a.mes+"' "+i+">"+a.mes_nombre+"</option>"})}}),""!=o?$("#lstMesGeneracionMarcaciones").append(o):$("#lstMesGeneracionMarcaciones").prop("disabled",!0)):$("#lstMesGeneracionMarcaciones").prop("disabled",!0)}function cargarTiposDisponiblesParaGeneracionMarcaciones(e,a,t){$("#lstTipoGeneracionMarcaciones").html(""),$("#lstTipoGeneracionMarcaciones").append("<option value=''>Seleccionar</option>"),$("#lstTipoGeneracionMarcaciones").prop("disabled",!1);var o="",i="";0<e&&0<a?($.ajax({url:"/horariosymarcaciones/gettiposgeneracion/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:e,mes:a},success:function(e){var a=jQuery.parseJSON(e);0<a.length&&$.each(a,function(e,a){i=t==a.tipo?"selected":"",o+="<option value='"+a.tipo+"' "+i+">"+a.tipo_descripcion+"</option>"})}}),""!=o?$("#lstTipoGeneracionMarcaciones").append(o):$("#lstTipoGeneracionMarcaciones").prop("disabled",!0)):$("#lstTipoGeneracionMarcaciones").prop("disabled",!0)}function obtenerFechaIniFinCalendario(e,a){var t="",o="";return 0<e&&0<a&&$.ajax({url:"/calendariolaboral/obtenerfechainifincalendario/",type:"POST",datatype:"json",async:!1,cache:!1,data:{gestion:e,mes:a},success:function(e){var a=jQuery.parseJSON(e);1==a.result&&(t=a.fecha_ini,o=a.fecha_fin)}}),{fecha_ini:t,fecha_fin:o}}function cargarGestionesRelaborales(t){var o="";$("#lstGestion").html(""),$("#lstGestion").append("<option value='0'>TODAS</option>"),$.ajax({url:"/relaborales/getgestionesrelaborales/",type:"POST",datatype:"json",async:!1,cache:!1,success:function(e){var a=jQuery.parseJSON(e);$.each(a,function(e,a){o=t==a?"selected":"",$("#lstGestion").append("<option value='"+a+"' "+o+">"+a+"</option>")})},error:function(){alert("Se ha producido un error Inesperado")}})}function limpiarMensajesErrorPorValidacionFormularioRegistroMasivo(){$("#divExcepcion").removeClass("has-error"),$("#helpErrorExcepcion").html(""),$("#divFechaIni").removeClass("has-error"),$("#helpErrorFechaIni").html(""),$("#divHoraIni").removeClass("has-error"),$("#helpErrorHoraIni").html(""),$("#divFechaFin").removeClass("has-error"),$("#helpErrorFechaFin").html(""),$("#divHoraFin").removeClass("has-error"),$("#helpErrorHoraFin").html(""),$("#divJustificacionRegistroMasivo").removeClass("has-error"),$("#helpErrorJustificacionRegistroMasivo").html(""),$("#divObservacionRegistroMasivo").removeClass("has-error"),$("#helpErrorObservacionRegistroMasivo").html(""),$("#divCompensacionTurno").removeClass("has-error"),$("#helpErrorCompensacionTurno").html(""),$("#divCompensacionEntradaSalida").removeClass("has-error"),$("#helpErrorCompensacionEntradaSalida").html(""),$("#divDestino").removeClass("has-error"),$("#helpErrorDestino").html("")}function cargarModalRegistroMasivoBoletas(){$("#txtFechaIni").datepicker("update",""),$("#txtFechaIni").val("").datepicker("update"),$("#txtFechaFin").datepicker("update",""),$("#txtFechaFin").val("").datepicker("update"),$("#txtHoraIni").val(""),$("#txtHoraFin").val(""),$("#txtJustificacionRegistroMasivo").val(""),$("#txtDestino").val(""),$("#divDestino").hide(),$("#txtObservacionRegistroMasivo").val("");var e=new Date,a=e.getMonth()+1,t=e.getDate(),o=(t<10?"0":"")+t+"-"+(a<10?"0":"")+a+"-"+e.getFullYear();$("#txtFechaIni").datepicker("update",o),$("#txtFechaFin").datepicker("update",o),$("#txtFechaIni").datepicker("hiden"),$("#txtFechaFin").datepicker("hiden");var i=$("#txtHoraIni").clockpicker({placement:"bottom",align:"left",autoclose:!0,default:"now"}).on("changeDate",function(e){$(this).hide()});$("#aHoraIni").off(),$("#aHoraIni").on("click",function(e){e.stopPropagation(),i.clockpicker("show")});var r=$("#txtHoraFin").clockpicker({placement:"bottom",align:"left",autoclose:!0,default:"now"}).on("changeDate",function(e){$(this).hide()});$("#aHoraFin").off(),$("#aHoraFin").on("click",function(e){e.stopPropagation(),r.clockpicker("show")}),cargaListaDeExcepcionesAdministrador(),$("#divCompensacion").hide(),$("#divHorarios").hide(),cargarCompensacionTurnos(),cargarCompensacionEntradaSalida(),$("#lstExcepcion").off(),$("#lstExcepcion").on("change",function(){if(""!=this.value){var e=0;""!=$("#lstExcepcion option:selected").data("lugar")&&null!=$("#lstExcepcion option:selected").data("lugar")&&(e=$("#lstExcepcion option:selected").data("lugar")),1==e?$("#divDestino").show():$("#divDestino").hide();var a=$("#lstExcepcion option:selected").text(),t=$("#lstExcepcion option:selected").data("codigo"),o=$("#lstExcepcion option:selected").data("color"),i=($("#lstExcepcion option:selected").data("descuento"),$("#lstExcepcion option:selected").data("descuento_descripcion")),r=$("#lstExcepcion option:selected").data("compensatoria"),n=$("#lstExcepcion option:selected").data("compensatoria_descripcion"),c=$("#lstExcepcion option:selected").data("genero"),l=($("#lstExcepcion option:selected").data("id_genero"),$("#lstExcepcion option:selected").data("cantidad"),$("#lstExcepcion option:selected").data("unidad"),$("#lstExcepcion option:selected").data("fraccionamiento"),$("#lstExcepcion option:selected").data("horario")),s=$("#lstExcepcion option:selected").data("horario_descripcion"),d=($("#lstExcepcion option:selected").data("refrigerio"),$("#lstExcepcion option:selected").data("refrigerio_descripcion")),p="&nbsp;";""!=$("#lstExcepcion option:selected").data("frecuencia_descripcion")&&null!=$("#lstExcepcion option:selected").data("frecuencia_descripcion")&&(p=$("#lstExcepcion option:selected").data("frecuencia_descripcion"));$("#lstExcepcion option:selected").data("redondeo");var u="&nbsp;";""!=$("#lstExcepcion option:selected").data("redondeo_descripcion")&&null!=$("#lstExcepcion option:selected").data("redondeo_descripcion")&&(u=$("#lstExcepcion option:selected").data("redondeo_descripcion"));var h="<div class='form-group'><label class='col-md-3 control-label'>Excepci&oacute;n</label><div class='col-md-9'><p class='form-control-static'>"+a+"</p></div></div></br>";h+="<div class='form-group'><label class='col-md-3 control-label'>Tipo</label><div class='col-md-9'><p class='form-control-static'>"+e+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>C&oacute;digo</label><div class='col-md-9'><p class='form-control-static'>"+t+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>Color</label><div class='col-md-9' style='background: "+o+";'><p class='form-control-static'>&nbsp;</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>Descuento</label><div class='col-md-9'><p class='form-control-static'>"+i+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>Compensatoria</label><div class='col-md-9'><p class='form-control-static'>"+n+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>G&eacute;nero</label><div class='col-md-9'><p class='form-control-static'>"+c+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>Horario</label><div class='col-md-9'><p class='form-control-static'>"+s+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>Refrigerio</label><div class='col-md-9'><p class='form-control-static'>"+d+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>Frecuencia</label><div class='col-md-9'><p class='form-control-static'>"+p+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>Disgregado</label><div class='col-md-9'><p class='form-control-static'>"+u+"</p></div></div></br>",h+="<div class='form-group'><label class='col-md-3 control-label'>Observaci&oacute;n</label><div class='col-md-9'><p class='form-control-static'>"+$("#lstExcepcion option:selected").data("observacion")+"</p></div></div></br>",$("#divModalBody").html(h),1==r?($("#divCompensacion").show(),cargarCompensacionTurnos(),cargarCompensacionEntradaSalida()):$("#divCompensacion").hide(),1==l?$("#divHorarios").show():$("#divHorarios").hide(),$(".iExcepcion").on("click",function(){0<$("#lstExcepcion").val()?$("#divModalDetalleExcepcion").modal("show"):alert("Debe seleccionar un tipo de Excepción o Salida inicialmente")}),$("#txtFechaIni").focus()}})}function cargaListaDeExcepcionesAdministrador(){$("#lstExcepcion").html(""),$("#lstExcepcion").append("<option value=''>Seleccionar..</option>"),$("#lstExcepcion").prop("disabled",!0);var t="";$.ajax({url:"/excepciones/list/",type:"POST",datatype:"json",async:!1,cache:!1,success:function(e){var a=jQuery.parseJSON(e);0<a.length&&($("#lstExcepcion").prop("disabled",!1),$.each(a,function(e,a){t=""!=a.frecuencia_descripcion&&null!=a.frecuencia_descripcion?"(M&Aacute;XIMO "+a.frecuencia_descripcion+")":"",$("#lstExcepcion").append("<option value='"+a.id+"' data-tipo_excepcion='"+a.tipo_excepcion+"' data-codigo='"+a.codigo+"' data-color='"+a.color+"' data-descuento='"+a.descuento+"' data-descuento_descripcion='"+a.descuento_descripcion+"' data-compensatoria='"+a.compensatoria+"' data-compensatoria_descripcion='"+a.compensatoria_descripcion+"' data-id_genero='"+a.genero_id+"' data-genero='"+a.genero+"' data-cantidad='"+a.cantidad+"' data-unidad='"+a.unidad+"' data-fraccionamiento='"+a.fraccionamiento+"' data-frecuencia_descripcion='"+a.frecuencia_descripcion+"' data-horario='"+a.horario+"' data-horario_descripcion='"+a.horario_descripcion+"' data-refrigerio='"+a.refrigerio+"' data-refrigerio_descripcion='"+a.refrigerio_descripcion+"'  data-lugar='"+a.lugar+"' data-lugar_descripcion='"+a.refrigerio_descripcion+"' data-redondeo='"+a.redondeo+"' data-redondeo_descripcion='"+a.redondeo_descripcion+"' data-observacion='"+a.observacion+"'>"+a.excepcion+" "+t+"</option>")}))},error:function(){$("#divMsjePorError").html(""),$("#divMsjePorError").append("Se ha producido un error Inesperado"),$("#divMsjeNotificacionError").jqxNotification("open")}})}function cargarCompensacionTurnos(){var e="";$("#lstCompensacionTurno").html(""),$("#lstCompensacionTurno").append("<option value=''>Seleccionar..</option>"),$("#lstCompensacionTurno").prop("disabled",!1);for(var a=1;a<=2;a++)e+="<option value='"+a+"'>"+a+"°</option>";$("#lstCompensacionTurno").append(e)}function cargarCompensacionEntradaSalida(){$("#lstCompensacionEntradaSalida").html(""),$("#lstCompensacionEntradaSalida").append("<option value=''>Seleccionar..</option>"),$("#lstCompensacionEntradaSalida").prop("disabled",!1),$("#lstCompensacionEntradaSalida").append("<option value='0'>ENTRADA</option><option value='1'>SALIDA</option>")}function validaFormularioRegistroMasivo(){var e=!0,a="";limpiarMensajesErrorPorValidacionFormularioRegistroMasivo();var t=null,o=0;null!=$("#lstExcepcion option:selected").data("lugar")&&(o=$("#lstExcepcion option:selected").data("lugar"));var i=$("#lstExcepcion"),r=$("#divExcepcion"),n=$("#helpErrorExcepcion"),c=$("#lstExcepcion").val(),l=($("#lstExcepcion option:selected").data("descuento"),$("#lstExcepcion option:selected").data("compensatoria")),s=($("#lstExcepcion option:selected").data("genero_id"),$("#lstExcepcion option:selected").data("cantidad"),$("#lstExcepcion option:selected").data("unidad"),$("#lstExcepcion option:selected").data("fraccionamiento"),$("#lstExcepcion option:selected").data("horario")),d=($("#lstExcepcion option:selected").data("refrigerio"),$("#txtFechaIni")),p=$("#divFechaIni"),u=$("#helpErrorFechaIni"),h=$("#txtFechaIni").val(),m=$("#txtHoraIni"),f=$("#divHoraIni"),v=$("#helpErrorHoraIni"),b=$("#txtHoraIni").val(),g=$("#txtFechaFin"),x=$("#divFechaFin"),y=$("#helpErrorFechaFin"),F=$("#txtFechaFin").val(),_=$("#txtHoraFin"),E=$("#divHoraFin"),S=$("#helpErrorHoraFin"),T=$("#txtHoraFin").val(),j=$("#txtJustificacionRegistroMasivo"),M=$("#divJustificacionRegistroMasivo"),w=$("#helpErrorJustificacionRegistroMasivo"),C=$("#txtJustificacionRegistroMasivo").val(),k=$("#txtDestino"),A=$("#divDestino"),D=$("#helpErrorDestino"),G=($("#txtDestino").val(),$("#txtObservacionRegistroMasivo"),$("#divObservacionRegistroMasivo"),$("#helpErrorObservacionRegistroMasivo"),$("#txtObservacionRegistroMasivo").val(),$("#lstCompensacionTurno")),I=$("#divCompensacionTurno"),P=$("#helpErrorCompensacionTurno"),H=$("#lstCompensacionTurno").val(),R=$("#lstCompensacionEntradaSalida"),q=$("#divCompensacionEntradaSalida"),O=$("#helpErrorCompensacionEntradaSalida"),N=$("#lstCompensacionEntradaSalida").val();if(""==c||0==c){e=!1;a="Debe seleccionar la excepci&oacute;n necesariamente.";r.addClass("has-error"),n.html(a),null==t&&(t=i)}if(""==h){e=!1;a="Debe seleccionar la fecha de inicio de la excepci&oacute;n.";p.addClass("has-error"),u.html(a),null==t&&(t=d)}if(""==F){e=!1;a="Debe seleccionar la fecha de finalizaci&oacute;n de la excepci&oacute;n.";x.addClass("has-error"),y.html(a),null==t&&(t=g)}if(procesaTextoAFecha(F,"-")<procesaTextoAFecha(h,"-")&&(e=!1,a="La fecha de inicio no puede ser superior a la fecha de finalizaci&oacute;n.",$("#divFechaIni").show(),$("#divFechaIni").addClass("has-error"),$("#helpErrorFechaIni").html(a),$("#divFechaFin").show(),$("#divFechaFin").addClass("has-error"),$("#helpErrorFechaFin").html(a),null==t&&(t=$("#txtFechaFin"+sufijo))),1==s){if(""==b){e=!1;a="Debe seleccionar la hora de inicio.";f.addClass("has-error"),v.html(a),null==t&&(t=m)}if(""==T){e=!1;a="Debe seleccionar la hora de finalizaci&oacute;n.";E.addClass("has-error"),S.html(a),null==t&&(t=_)}if(h==F&&""!=h&&""!=b&&""!=T)if(0<horaEsMayorAhora(b,T)){e=!1;a="Debe modificar la hora de finalizaci&oacute;n debido a inconsistencia.";E.addClass("has-error"),S.html(a),null==t&&(t=_)}}if(""==C){e=!1;a="Debe introducir la justificaci&oacute;n para solicitar la excepci&oacute;n.";M.addClass("has-error"),w.html(a),null==t&&(t=j)}if(1==l){if(0==H||null==H){e=!1;a="Debe seleccionar el turno en el cual se compensar&aacute; el permiso.";I.addClass("has-error"),P.html(a),null==t&&(t=G)}if(N<0||""==N||null==N){e=!1;a="Debe seleccionar si lo compensaci&oacute;n se efecturar&aacute; en la Entrada o en la Salida del turno.";q.addClass("has-error"),O.html(a),null==t&&(t=R)}}if(1==o&&""==$("#txtDestino").val()){e=!1;a="Debe especificar el lugar de asignaci&oacute;n de la excepci&oacute;n.";A.addClass("has-error"),D.html(a),null==t&&(t=k)}return null!=t&&t.focus(),e}function horaEsMayorAhora(e,a){return $.ajax({url:"/controlexcepciones/horaesmayorahora/",type:"POST",datatype:"html",async:!1,cache:!1,data:{hora_ini:e,hora_fin:a},success:function(e){}}).responseText}function verificaCruceDeHorariosYExcesoEnUso(e,a,t,o,i,r,n,c,l){var s="";return $.ajax({url:"/controlexcepciones/verificacruceexcesouso/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id:e,relaboral_id:a,excepcion_id:t,excepcion_id:t,fecha_ini:o,hora_ini:i,fecha_fin:r,hora_fin:n,horario:c,justificacion:l},success:function(e){var a=jQuery.parseJSON(e);0==a.result||(s=(a.result,a.msj))},error:function(){s="Se ha producido un error Inesperado"}}),s}function verificaFrecuencia(e,a,t,o,i,r,n,c){var l="";return $.ajax({url:"/controlexcepciones/verificafrecuencia/",type:"POST",datatype:"json",async:!1,cache:!1,data:{id_controlexcepcion:e,id_relaboral:a,id_excepcion:t,fecha_ini:o,hora_ini:i,fecha_fin:r,hora_fin:n,horario:c},success:function(e){var a=jQuery.parseJSON(e);1==a.result||2==a.result||(l=(a.result,a.msj))},error:function(){l="Se ha producido un error Inesperado"}}),l}function verificaGenero(e,a){var t=!0;switch(a){case 1:"F"!=e&&(t=!1);break;case 2:"M"!=e&&(t=!1)}return t}