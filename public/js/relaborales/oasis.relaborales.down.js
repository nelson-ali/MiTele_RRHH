function cargarMotivosBajas(r,t){$.ajax({url:"/relaborales/listmotivosbajas",type:"POST",datatype:"json",cache:!1,success:function(a){var e=jQuery.parseJSON(a);0<e.length&&($("#lstMotivosBajas").html(""),$("#lstMotivosBajas").append("<option value='0_0_0_0'>Seleccionar..</option>"),$.each(e,function(a,e){switch(t){case 1:case 4:case 5:case 6:1==e.permanente&&(r==e.id?$selected="selected":$selected="",$("#lstMotivosBajas").append("<option value='"+e.id+"_"+e.fecha_ren+"_"+e.fecha_acepta_ren+"_"+e.fecha_agra_serv+"' "+$selected+">"+e.motivo_baja+"</option>"));break;case 2:case 7:1==e.eventual&&(r==e.id?$selected="selected":$selected="",$("#lstMotivosBajas").append("<option value='"+e.id+"_"+e.fecha_ren+"_"+e.fecha_acepta_ren+"_"+e.fecha_agra_serv+"'  optFechaRen='"+e.fecha_ren+"' optFechaAceptaRen='"+e.fecha_acepta_ren+"' optFechaAgraServ='"+e.fecha_ren+"' "+$selected+">"+e.motivo_baja+"</option>"));break;case 3:1==e.consultor&&(r==e.id?$selected="selected":$selected="",$("#lstMotivosBajas").append("<option value='"+e.id+"_"+e.fecha_ren+"_"+e.fecha_acepta_ren+"_"+e.fecha_agra_serv+"' optFechaRen='"+e.fecha_ren+"' optFechaAceptaRen='"+e.fecha_acepta_ren+"' optFechaAgraServ='"+e.fecha_ren+"' "+$selected+">"+e.motivo_baja+"</option>"))}}))}})}function defineFechasBajas(a,e,r){$("#divFechasBaja").show(),$("#txtFechaBaja").jqxDateTimeInput({enableBrowserBoundsDetection:!0,height:24,formatString:"dd-MM-yyyy"}),objFocus=$("#txtFechaBaja"),1==r?($("#divFechasAgraServBaja").show(),$("#txtFechaAgraServBaja").jqxDateTimeInput({enableBrowserBoundsDetection:!0,height:24,formatString:"dd-MM-yyyy"}),objFocus=$("#txtFechaAgraServBaja")):$("#divFechasAgraServBaja").hide(),1==e?($("#divFechasAceptaRenBaja").show(),$("#txtFechaAceptaRenBaja").jqxDateTimeInput({enableBrowserBoundsDetection:!0,height:24,formatString:"dd-MM-yyyy"}),objFocus=$("#txtFechaAceptaRenBaja")):$("#divFechasAceptaRenBaja").hide(),1==a?($("#divFechasRenBaja").show(),$("#txtFechaRenBaja").jqxDateTimeInput({enableBrowserBoundsDetection:!0,height:24,formatString:"dd-MM-yyyy"}),objFocus=$("#txtFechaRenBaja")):$("#divFechasRenBaja").hide(),objFocus.focus()}function agregarCargoSeleccionadoEnGrillaParaBaja(a){var e=a.id_cargo,r="";null!=a.cargo_gestion&&""!=a.cargo_gestion&&(r=a.cargo_gestion);var t=a.cargo_codigo,s=(a.cargo_resolucion_ministerial_id,a.cargo_resolucion_ministerial),o=(a.id_finpartida,a.finpartida,a.id_condicion),i=a.condicion,n=(a.id_organigrama,a.gerencia_administrativa),c=a.departamento_administrativo,l=a.nivelsalarial,d=a.cargo,h=a.sueldo,j=(a.nivelsalarial_resolucion_id,a.nivelsalarial_resolucion);$("#tr_cargo_seleccionado").html(""),$("#tr_cargo_seleccionado_editar").html("");var v="<td class='text-center'>"+t+"</td><td class='text-center'>"+r+"</td><td class='text-center'>"+s+"</td><td class='text-center'>"+j+"</td><td class='text-center'>"+i+"</td><td>"+n+"</td><td>"+c+"</td><td>"+l+"</td><td>"+d+"</td><td class='text-center'>"+h+"</td>";$("#tr_cargo_seleccionado_baja").append(v),$("#hdnIdCargoSeleccionadoBaja").val(e),$("#hdnIdCondicionSeleccionadaBaja").val(o),$("#popupWindowCargo").jqxWindow("close")}function habilitarCamposParaBajaRegistroDeRelacionLaboral(a,e,r){cargarMotivosBajas(r),defineFechasBajas()}function deshabilitarCamposParaBajaRegistroDeRelacionLaboral(){$("#tr_cargo_seleccionado_baja").html(""),$("#hdnIdPersonaSeleccionadaBaja").val(0),$("#NombreParaBajaRegistro").html("")}function validaFormularioPorBajaRegistro(){var a=!0,e=null,r="";$(".msjs-alert").hide(),limpiarMensajesErrorPorValidacionBaja();var t=$("#hdnIdRelaboralBaja").val(),s=$("#txtFechaBaja").jqxDateTimeInput("getText"),o=0,i=0,n=0,c=0,l="",d="",h="";if(0!=t&&null!=t&&null!=t||($("#divMsjeError").show(),$("#divMsjeError").addClass("alert alert-danger alert-dismissable"),$("#aMsjeError").html("Error en la selecci&oacute;n del registro de relaci√≥n laboral correspondiente."),a=!1),""!=$("#lstMotivosBajas").val()){var j=$("#lstMotivosBajas").val().split("_");o=j[0],i=j[1],n=j[2],c=j[3]}return 0!=o&&null!=o||(a=!1,r="Debe definir el motivo de baja.",$("#divMotivosBajas").addClass("has-error"),$("#helpErrorMotivosBajas").html(r),null==e&&(e=$("#lstMotivosBajas"))),null!=s&&""!=s&&null!=s||(a=!1,r="Debe definir la fecha de baja.",$("#divFechasBajas").addClass("has-error"),$("#helpErrorFechasBajas").html(r),null==e&&(e=$("#txtFechaBaja"))),1==i&&(""!=(l=$("#txtFechaRenBaja").jqxDateTimeInput("getText"))&&""!=l&&"undefined"!=l||(a=!1,r="Debe definir la fecha de renuncia necesariamente.",$("#divFechasRenBaja").addClass("has-error"),$("#helpErrorFechasRenBajas").html(r),null==e&&(e=$("#txtFechaRenBaja")))),1==n&&(""!=(d=$("#txtFechaAceptaRenBaja").jqxDateTimeInput("getText"))&&""!=d&&"undefined"!=d||(a=!1,r="Debe definir la fecha de aceptaci&oacute;n de renuncia necesariamente.",$("#divFechasAceptaRenBaja").addClass("has-error"),$("#helpErrorFechasAceptaRenBajas").html(r),null==e&&(e=$("#txtFechaAceptaRenBaja")))),1==c&&(""!=(h=$("#txtFechaAgraServBaja").jqxDateTimeInput("getText"))&&""!=h&&"undefined"!=h||(a=!1,r="Debe definir la fecha de agradecimiento de servicios necesariamente.",$("#divFechasAgraServBaja").addClass("has-error"),$("#helpErrorFechasAgraServBajas").html(r),null==e&&(e=$("#txtFechaAgraServBaja")))),null!=e&&e.focus(),a}function limpiarMensajesErrorPorValidacionBaja(){$("#helpErrorMotivosBajas").html(""),$("#divMotivosBajas").removeClass("has-error"),$("#helpErrorFechasBaja").html(""),$("#divFechasBaja").removeClass("has-error"),$("#helpErrorFechasRenBaja").html(""),$("#divFechasRenBaja").removeClass("has-error"),$("#helpErrorFechasAceptaRenBaja").html(""),$("#divFechasAceptaRenBaja").removeClass("has-error"),$("#helpErrorFechasAceptaRenBaja").html(""),$("#divFechasAceptaRenBaja").removeClass("has-error"),$("#helpErrorFechasAgraServBaja").html(""),$("#divFechasAgraServBaja").removeClass("has-error")}function guardarRegistroBaja(l){var a=!0;$("#divCarga").hide();var d=$("#hdnIdRelaboralBaja").val(),h=$("#txtFechaBaja").jqxDateTimeInput("getText"),j=0,e=0,r=0,t=0,s="",o="",i="";if(""!=$("#lstMotivosBajas").val()){var n=$("#lstMotivosBajas").val().split("_");j=n[0],e=n[1],r=n[2],t=n[3]}1<=e&&(s=$("#txtFechaRenBaja").jqxDateTimeInput("getText")),1<=r&&(o=$("#txtFechaAceptaRenBaja").jqxDateTimeInput("getText")),1<=t&&(i=$("#txtFechaAgraServBaja").jqxDateTimeInput("getText"));var c=$("#txtObservacionesBaja").val();if(0<d&&0<j&&""!=h)a=$.ajax({url:"/relaborales/down/",type:"POST",datatype:"json",async:!1,data:{id:d,id_motivobaja:j,fecha_baja:h,fecha_ren:s,fecha_acepta_ren:o,fecha_agra_serv:i,observacion:c},success:function(a){var e=jQuery.parseJSON(a);if($(".msjes").hide(),1==e.result){var r=h.split("-"),t=parseInt(r[2]),s=parseInt(r[1]),o="01-"+r[1]+"-"+r[2];if(console.log("datosBajas: gestion: "+t+", mes: "+s+", fechaInicio: "+o),generarMarcacion(1,d,t,s,o,h,"H",0,fechaConvertirAFormato(l.fecha_incor,"-"),h)?(vaciarRegistrosDeHorariosYmarcaciones(d,t,s,"M"),generarMarcacion(1,d,t,s,o,h,"M",0,fechaConvertirAFormato(l.fecha_incor,"-"),h)):darDeBajaRegistrosEfectivosDeHorariosYmarcaciones(d,t,s,"HM"),$("#divMsjeExito").show(),$("#divMsjeExito").addClass("alert alert-success alert-dismissable"),$("#aMsjeExito").html(e.msj),$("#jqxTabs").jqxTabs("enableAt",0),$("#jqxTabs").jqxTabs("disableAt",1),$("#jqxTabs").jqxTabs("disableAt",2),$("#jqxTabs").jqxTabs("disableAt",3),deshabilitarCamposParaBajaRegistroDeRelacionLaboral(),null!=d&&0<d&&11!=j&&12!=j&&13!=j){var i=new Date,n=parseInt(i.getFullYear().toString()),c=$("#FechaIncor").jqxDateTimeInput("getText").split("-");if(n==parseInt(c[2]))defineListaDestinatarios(d)&&(CKEDITOR.instances.txtEditorMensaje&&CKEDITOR.instances.txtEditorMensaje.destroy(),$("#txtEditorMensaje").val(""),CKEDITOR.replace("txtEditorMensaje",{customConfig:"config.min.js",on:{instanceReady:function(a){CKEDITOR.instances.txtEditorMensaje.focus()}}}),CKEDITOR.add,$("#popupMensajeNuevaIncorporacion").off(),$("#popupMensajeNuevaIncorporacion").modal("show"),$("#btnEnviarMensaje").off(),$("#btnEnviarMensaje").on("click",function(){enviarMensajePorOperacion(d,0)&&$("#popupMensajeNuevaIncorporacion").modal("hide")}))}$("#jqxgrid").jqxGrid("updatebounddata")}else 0==e.result?($("#divMsjePeligro").show(),$("#divMsjePeligro").addClass("alert alert-warning alert-dismissable"),$("#aMsjePeligro").html(e.msj)):($("#divMsjeError").show(),$("#divMsjeError").addClass("alert alert-danger alert-dismissable"),$("#aMsjeError").html(e.msj))},error:function(){alert("Se ha producido un error Inesperado")}});else a=!1;return a}function generarMarcacion(a,e,r,t,s,o,i,n,c,l){var d="",h=!1;switch(i){case"H":d="generarmarcacionprevista";break;case"M":d="generarmarcacionefectivadirecta"}return""!=d&&$.ajax({url:"/horariosymarcaciones/"+d+"/",type:"POST",datatype:"html",async:!1,cache:!1,data:{opcion:a,id_relaboral:e,gestion:r,mes:t,fecha_ini:s,fecha_fin:o,clasemarcacion:i,estado:n,fecha_incor:c,fecha_baja:l},beforeSend:function(a){$("#divCarga").css({display:"block"})},complete:function(){$("#divCarga").css("display","none")},success:function(a){1===jQuery.parseJSON(a).result&&(h=!0)},error:function(){return!1}}),h}function vaciarRegistrosDeHorariosYmarcaciones(a,e,r,t){var s=!1;return $.ajax({url:"/horariosymarcaciones/vaciar/",type:"POST",datatype:"html",async:!1,cache:!1,data:{id_relaboral:a,gestion:e,mes:r,clasemarcacion:t},beforeSend:function(a){$("#divCarga").css({display:"block"})},complete:function(){$("#divCarga").css("display","none")},success:function(a){1==jQuery.parseJSON(a).result&&(s=!0)},error:function(){return!1}}),s}function darDeBajaRegistrosEfectivosDeHorariosYmarcaciones(a,e,r,t){var s=!1;return $.ajax({url:"/horariosymarcaciones/del/",type:"POST",datatype:"html",async:!1,cache:!1,data:{id_relaboral:a,gestion:e,mes:r,clasemarcacion:t},beforeSend:function(a){$("#divCarga").css({display:"block"})},complete:function(){$("#divCarga").css("display","none")},success:function(a){var e=jQuery.parseJSON(a);$(".msjs-alert").hide(),1==e.result&&(s=!0)},error:function(){return!1}}),s}